<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>piano skill 採点</title>
    <meta name="description" content="ピアノ採点ホームページ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <h1>ピアノスキル 採点</h1>
    <form name="fm">
        <h4>【1】ファイルを選択</h4>
            <input type="file" name="target_file">
        <h4>【2】曲の指定</h4>
            <select name="target_song">
                <option value="0">指定なし</option>
                <option value="1">きらきら星</option>
                <option value="2">カノン</option>
                <option value="3">エリーゼのために</option>
            </select>
        <h4>【3】名前を記入（任意）</h4>
            <input type="text" id="user_input_name">
    <div id="button_block">
        <input type="button" id="btnsend" name="submit" value="採点する" onclick="postData()">
    </div>
    </form>
    <hr>
    <p>
        ユーザー：<span id="result_user"></span>
    </p>
    <p>
        スコア：<span id="result_score"></span>
    </p>
</body>
</html>

<script>
function postData(){

    const apiUrl = "https://flhrsaddm1.execute-api.ap-northeast-1.amazonaws.com/dev";

    // 入力情報を定義
    const user_input_name = document.getElementById("user_input_name").value
    const data = { user : user_input_name };

    // アウトプットを定義
    const result_user = document.getElementById("result_user");
    const result_score = document.getElementById("result_score");

    // JSONデータをajax通信でPOST送信
    fetch(apiUrl,{
        method: "POST",
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        body = JSON.parse(data["body"]);

        // アウトプット
        result_user.textContent = body.user;
        result_score.textContent = body.score;       
    })
    .catch((err) => {
        result.textContent = `【通信に失敗】エラー原因：${err}`;
    })
}
</script>

<style>
#button_block{
    text-align: center;
    margin: 5%;
    height: 80px;
}
#btnsend{
    background-color: black;
    width: 50%;
    height: 90%;
    color: white;
    cursor: pointer;
    font-size: large;
}
</style>